{% extends "judgementapp/base.html" %}

{% block content %}

	   <div class="well">

        <h6> <span {% if query.length > 200 %} class="long" {% endif %}>{{ query.qId }} - {{ query.criteria }} </span> <br>  <a style="text-align: right;", href="{% url 'judgementapp.views.query' qId=query.qId %}" class="btn">Back to Queries</a></h6>
        
    </div>

    <div class="row">
      
      <div class="span3">
      {% if prev %}
        <a href="{% url 'judgementapp.views.document' qId=query.qId docId=prev.document.docId %}" class="btn">Prev Document</a>
      {% endif %}
      </div>

      <div class="span6"><h3 style="text-align: center;">Document "{{ document.docId }}" ({{ rank }} / {{total_rank}}) </h3></div>

      <div class="span3" align="right">
      {% if next %}
        <a href="{% url 'judgementapp.views.document' qId=query.qId docId=next.document.docId %}" class="btn">Next Document</a>
      {% endif %}
      </div>

    </div>

	<div class="row">
        
        <div class="span9" style="height:750px; position:relative;"  id='content'>
            <iframe frameborder="5" width="100%" height="100%" srcdoc='{{ content }}'></iframe> 
        </div>
      
        
        <script>
          // $('div#content').mouseup(function() {
          //     document.getElementById("comment").value = getSelectedText();
          // });

          function getSelectedText() {
              if (window.getSelection) {
                  return window.getSelection().toString();
              } else if (document.selection) {
                  return document.selection.createRange().text;
              }
              return '';
          }

          function captureSelection() {
            textarea = document.getElementById('comment');
            if (textarea.value=='Comments') {
              textarea.value = '';
            }
            if (textarea.value.length > 0) {
              textarea.value = textarea.value + '\n';
            }
            textarea.value = textarea.value + '"' + getSelectedText() + '"';
          }
    </script>

	<script>
		function save_slider() {
			var understandability_value = $( "#slider-colored" ).slider( "value" );
			var trust_value = $( "#slider-volume").slider("value");
			var data = {'understandability': understandability_value, 'trustability': trust_value};
			var URL = '/ajax/'.concat( {{query.qId}}, '/', '{{document.docId}}', '/');
			$.post(URL, data, function(response){
			});
		}
	</script> 
        <div class="span3">
            <form class="form-inline" action="{% url 'judgementapp.views.judge' qId=query.qId docId=document.docId %}" method="post">
                {% csrf_token %}

                {% if query.diseases %}
                  <legend>Relevance Criteria</legend>
                  Relevant documents should contain information allowing the user to understand that they have <em>{{ query.diseases }}</em>.
                {% endif %}

                <legend class="small-bottom-margin">Judgement</legend>
                <div class="control-group" style="margin-top:0px">
                    <label class="radio">
                      <input type="radio" name="relevance" id="relevance1" value="-1" {% if judgement.relevance == -1 %} checked {% endif %}>
                      Unjudged
                    </label><br>
                    <label class="radio">
                     <input type="radio" name="relevance" id="relevance2" value="2" {% if judgement.relevance == 2 %} checked {% endif %}>
                      Highly relevant
                    </label><br>
                    <label class="radio">
                      <input type="radio" name="relevance" id="relevance1" value="1" {% if judgement.relevance == 1 %} checked {% endif %}>
                      Somewhat relevant
                    </label><br>
                    <label class="radio">
                      <input type="radio" name="relevance" id="relevance0" value="0" {% if judgement.relevance == 0 %} checked {% endif %}>
                      Not relevant
                    </label>
                </div>

                <legend class="small-bottom-margin">Understandability</legend>
                <div class="control-group">
                    <label class="range">
        			<div id="slider_case"> 
						<div id="slider-colored" class="pip-ninja"> </div>
		            </div>
                   
				  <script>
            	  $(function() {
						var options = get_labels("Easy","Neutral","Hard");
                    	$( "#slider-colored" ).slider({
                            min:0, max:100, animate:400,
                            value:{% if judgement.understandability == -1 %} 50 {% else %} {{judgement.understandability}} {% endif %},
                            change: save_slider,
                        }).slider("pips",{rest: "label", labels: options})
                	  });
            	  </script>
                  </label>
                </div>
 
                <legend class="small-bottom-margin">Trustworthiness</legend>
                <div class="control-group">
                    <label class="range">
        			<div id="slider_case"> 
						<div id="slider-volume" class="pip-ninja"> </div>
		            </div>
                  <script>
           	  
				  $(function() {
						var options = get_labels("Low","Medium","High");
                    	$( "#slider-volume").slider({
                            min:0, max:100, animate:400,
                            value:{% if judgement.trustability == -1 %} 50 {% else %} {{judgement.trustability}} {% endif %},
                            change: save_slider,
                        }).slider("pips",{rest: "label", labels: options})
                	  });
            	  </script>
                  </label>
                </div>
                
                <legend>Comment (optional)</legend>
                 <div class="control-group" id="small_margin">
                    
                    <div class="controls">
                      <textarea rows="10" class="span3", id="comment" name="comment">{% if judgement.comment %}{{ judgement.comment }}{% else %}{% endif %}</textarea>
                      <button type="button" class="btn btn-link" id="capture" onclick="captureSelection()">Insert Selected Text</button>
                    </div>
                  </div>
                

                <div class="form-actions">

                    <button id="buttongo" type="submit" class="btn btn-primary" size="20">Save</button> {% if next %} <button type="submit" name="next", class="btn btn-primary" size="20">Save & Next</button> {% endif %}
	
                </div>
            </form>
  </div>
</div>

{% endblock %}
